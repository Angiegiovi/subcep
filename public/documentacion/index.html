<!DOCTYPE html>
<html>

    <head>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">

        <title>SCEP</title>

        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="font-awesome/css/font-awesome.css" rel="stylesheet">

        <!-- Toastr style -->
        <link href="css/plugins/toastr/toastr.min.css" rel="stylesheet">

        <!-- Gritter -->
        <link href="js/plugins/gritter/jquery.gritter.css" rel="stylesheet">

        <link href="css/animate.css" rel="stylesheet">
        <link href="css/style.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/css/buttons.dataTables.min.css">
        <link rel="stylesheet" type="text/css" href="/bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="/bower_components/datatables.net-responsive-bs/css/responsive.bootstrap.min.css">

    </head>

    <body>
        <div id="now_loading">
            Cargando ...<br/>
            <i class="ajax-loader"></i>
        </div>
        <div id="wrapper" style="visibility:hidden;background-image: url(img/fondo1.jpg?5); background-repeat: no-repeat;">
            <nav class="navbar-default navbar-static-side" role="navigation">
                <div class="sidebar-collapse">
                    <ul class="nav metismenu" id="side-menu">
                        <li class="nav-header" style="background: transparent;">
                            <div class="dropdown profile-element"> 
                                <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                                    <span class="clear"> <span class="block m-t-xs"> <strong class="font-bold">{{user.username}}</strong>
                                        </span> <span class="text-muted text-xs block">Usuario<b class="caret"></b></span> </span> </a>
                                <ul class="dropdown-menu animated fadeInRight m-t-xs">
                                    <li><a href="profile.html">Perfil</a></li>
                                    <li><a href="contacts.html">Contactos</a></li>
                                    <li><a href="mailbox.html">Correo</a></li>
                                    <li class="divider"></li>
                                    <li><a href="login.html">Salir</a></li>
                                </ul>
                            </div>
                            <div class="logo-element">
                                SCEP
                            </div>
                        </li>
                        <li class="active"><a href="#empresasPublicas"><img class="fa fa-th-large" src="img/empresas.png" style="height:1em"> <span class="nav-label">Empresas públicas</span></a></li>
                        <li class="active"><a href="#estadosFinancieros"><img class="fa fa-th-large" src="img/eeff.png" style="height:1em"> <span class="nav-label">Estados financieros</span></a></li>
                        <li class="active"><a href="#UAI" v-on:click="abrirUAI"><img class="fa fa-th-large" src="img/uai.png" style="height:1em"> <span class="nav-label">UAI</span></a></li>
                        <li class="active"><a href="#firmasDeAuditoria" v-on:click="abrirFirmasDeAuditoria"><img class="fa fa-th-large" src="img/firmas.png" style="height:1em"> <span class="nav-label">Firmas de auditoria</span></a></li>
                        <li class="active"><a href="#PEIyPOA"><img class="fa fa-th-large" src="img/calendar.png" style="height:1em"> <span class="nav-label">PEI y POA</span></a></li>
                        <li class="active"><a href="#seguimientoDeTareas"><img class="fa fa-th-large" src="img/tasks.png" style="height:1em"> <span class="nav-label">Seguimiento de tareas</span></a></li>
                        <li class="active"><a href="#cambio_password"><img class="fa fa-th-large" src="img/candado.png" style="height:1em"> <span class="nav-label">Cambio de contraseña</span></a></li>
                        <li class="active" v-if="user.username==='admin'">
                            <a href="index.html"><i class="fa fa-th-large"></i> <span class="nav-label">Admin</span> <span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level">
                                <li class="active"><a href="#estadosFinancierosAdmin">Estados financieros ADM</a></li>
                            </ul>
                        </li>
                    </ul>

                </div>
            </nav>

            <div id="page-wrapper" class="gray-bg dashbard-1" style=''>
                <div class="top-header border-bottom">
                    <nav role="navigation" class="navbar navbar-static-top" style="margin-bottom: 0px;background:#3b5998;">
                        <div class="navbar-header">
                            <a href="javascript:void(0)" class="navbar-minimalize"><img src="img/logo.png?3" style="height: 55px;"></a>
                        </div>
                        <ul class="nav navbar-top-links navbar-right"><li></li>   <li><a href="login.html"><i class="fa fa-sign-out"></i>Cerrar Sesión</a></li> </ul>
                    </nav>
                </div>
                <carousel>
                    <!--
                        EMPRESAS PUBLICAS
                    -->
                    <carouselitem id="empresasPublicas" class="active">
                        <div class="row wrapper border-bottom page-heading">
                            <div class="wrapper wrapper-content">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="ibox float-e-margins">
                                            <div class="ibox-title">
                                                <h5>DETALLE EMPRESAS PÚBLICAS</h5>
                                            </div>
                                            <div class="ibox-content">
                                                <div style="overflow-y: scroll;">
                                                    <newtable v-bind:model="empresa" v-on:selectrow="seleccionaEmpresa" title="" id_field="cod_empresa" group="sub_empresa" open="0" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class="row">
                                    <div id="descripcionEmpresa" class="col-lg-12">
                                        <div class="ibox float-e-margins">
                                            <div class="col-lg-12">
                                                <div class="ibox">
                                                    <div class="ibox-title">
                                                        <h5> {{empresa.nombre_empresa}}</h5>
                                                    </div>
                                                    <div class="ibox-content" v-html="empresa.detalle_empresa">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </carouselitem>

                    <!--
                        ESTADOS FINANCIEROS
                    -->
                    <carouselitem id="estadosFinancieros">
                        <div class="row wrapper border-bottom page-heading">
                            <div class="wrapper wrapper-content">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="ibox">
                                            <div class="ibox-title">
                                                <h5>ESTADOS FINANCIEROS</h5>
                                            </div>
                                            <div class="ibox-content">
                                                <div style="overflow: hidden;">
                                                    <div class="form-group">
                                                      <div class="col-lg-10">
                                                        <select class="form-control" id="select" v-model='empresaSeleccionada' v-on:change="cargarEstadosFinancieros">
                                                            <option v-for="emp in empresas" v-bind:value='emp.id'>{{emp.attributes.nombre_empresa}}</option>
                                                        </select>
                                                      </div>
                                                      <div class="col-lg-2">
                                                        <select class="form-control" id="gestion" v-model='empresaSeleccionadaGestion' v-on:change="cargarEstadosFinancieros">
                                                            <option value='2017'>2017</option>
                                                            <option value='2016'>2016</option>
                                                            <option value='2015'>2015</option>
                                                            <option value='2014'>2014</option>
                                                            <option value='2013'>2013</option>
                                                        </select>
                                                      </div>
                                                    </div>
                                                    <hr>
                                                    <div id="cuadros_financieros" class="row">
                                                        <div v-for="estado in cuadros_financieros" class="col-md-12">
                                                            <div class="ibox float-e-margins" v-bind:title="empresaSeleccionada">
                                                                <div class="ibox-title">
                                                                    <h5>{{estado.attributes.titulo}}</h5>
                                                                    <div class="ibox-tools">
                                                                        <a v-if='eeffEditable.indexOf(estado.id)==-1' v-on:click='editEEFF(estado)'>
                                                                            <i class="fa fa-pencil-square-o"></i>
                                                                        </a>
                                                                        <a v-if='eeffEditable.indexOf(estado.id)>-1' v-on:click='saveEEFF(estado)'>
                                                                            <i class="fa fa-floppy-o"></i>
                                                                        </a>
                                                                    </div>
                                                                </div>
                                                                <div class="ibox-content indicador">
                                                                    <!-- a v-bind:href="estado.attributes.archivo?estado.attributes.archivo.url:'#'">{{estado.attributes.archivo?estado.attributes.archivo.name:''}}</a -->
                                                                    <div class="col-md-6">
                                                                        <div v-if='eeffEditable.indexOf(estado.id)==-1' v-html="estado.html"></div>
                                                                        <htmleditor v-if='eeffEditable.indexOf(estado.id)>-1' v-bind:model="estado.attributes" v-bind:property="'contenido'" />
                                                                    </div>
                                                                    <div class="col-md-6">
                                                                        <basic-chart title="Presupuesto aprobado"
                                                                             refreshWith="select,gestion"
                                                                             mcols="aprobado"
                                                                             type="bar"
                                                                             v-bind:mdata='estado.calculatedChart' />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <a class="btn btn-primary" v-on:click="addCCFF"><h1><i class="fa fa-plus-circle"></i></h1></a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </carouselitem>
                    <!--
                        ESTADOS FINANCIEROS ADMIN
                    -->
                    <carouselitem id="estadosFinancierosAdmin">
                        <div class="row wrapper border-bottom page-heading">
                            <div class="wrapper wrapper-content">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="ibox">
                                            <div class="ibox-title">
                                                <h5>ESTADOS FINANCIEROS ADMIN</h5>
                                            </div>
                                            <div class="ibox-content">
                                                <div style="overflow-y: scroll;">
                                                    <abm v-bind:model="estado_financiero_adm" v-bind:editable="true" buttons='close,save,delete'></abm>
                                                    <abm v-bind:model="carga_estado" v-bind:editable="true" buttons='close,save,delete'></abm>
                                                    <!-- file-viewer /-->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </carouselitem>
                    <!--
                        FIRMAS
                    -->
                    <carouselitem id="firmasDeAuditoria">
                        <div class="row wrapper border-bottom page-heading">
                            <div class="wrapper wrapper-content">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="ibox">
                                            <div class="ibox-title">
                                                <h5>FIRMAS DE AUDITORÍA</h5>
                                            </div>
                                            <div class="ibox-content">
                                                <div style="overflow: auto;">
                                                    <abm id="abmFirmasDeAuditoria" v-bind:model="firma_auditoria" v-bind:editable="true" buttons="close,save,delete"></abm>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </carouselitem>
                    <!--
                        UAI
                    -->
                    <carouselitem id="UAI">
                        <div class="row wrapper border-bottom page-heading">
                            <div class="wrapper wrapper-content">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="ibox">
                                            <div class="ibox-title">
                                                <h5>UAI</h5>
                                            </div>
                                            <div class="ibox-content">
                                                <div style="overflow: auto;">
                                                    <abm id="abmUAI" v-bind:model="uai" v-bind:editable="true" toolbar='new,search' buttons="close,save,delete"></abm>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </carouselitem>
                    <!--
                        Seguimiento de tareas
                    -->
                    <carouselitem id="seguimientoDeTareas">
                        <div class="row wrapper border-bottom page-heading">
                            <div class="wrapper wrapper-content">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="ibox">
                                            <div class="ibox-title">
                                                <h5>TAREAS</h5>
                                                <div class="ibox-tools">
                                                    <a href="#asignarTarea" class="btn btn-primary btn-xs" v-on:click='crearTarea'>Asignar tarea</a>
                                                </div>
                                            </div>
                                            <div class="ibox-content">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-btn">
                                                            <a class="btn btn-default"  v-on:click='listarTareas'>
                                                                <i class="fa fa-refresh"></i>
                                                                <small class="hidden-xs hidden-sm">Recargar</small>
                                                            </a>
                                                        </span>
                                                        <input type="text" class="form-control form-file-progress" placeholder="Busqueda" v-model="busquedaTareas">
                                                        <span class="input-group-btn">
                                                            <span class="btn btn-primary" type="button" v-on:click="buscarTarea">
                                                                <i class="fa fa-search"></i>
                                                                <small class="hidden-xs hidden-sm">Buscar</small>
                                                            </span>
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="project-list" style="overflow: auto;">

                                                    <table class="table table-hover">
                                                        <tbody>
                                                            <tr v-for='tareaI in tareas'>
                                                                <td class="project-status">
                                                                    <span class="label label-primary">
                                                                        <i v-bind:class="{'fa':true,'fa-clock-o':tareaI.attributes.estado!=='Completado','fa-check':tareaI.attributes.estado==='Completado'}"></i>
                                                                        <span class="hidden-xs hidden-sm">{{tareaI.attributes.estado}}</span>
                                                                    </span>
                                                                </td>
                                                                <td class="project-title">
                                                                    <a href="#detalleTarea" v-on:click='seleccionaTarea(tareaI)'>{{tareaI.attributes.cod_tarea}} {{tareaI.attributes.nombre_tarea}}</a>
                                                                    <br>
                                                                    <small>{{tareaI.attributes.created_at}}</small>
                                                                </td>
                                                                <td class="project-completion">
                                                                    <small>Avance: {{tareaI.attributes.avance}}%</small>
                                                                    <div class="progress progress-mini">
                                                                        <div v-bind:style="{width: tareaI.attributes.avance+'%'}" v-bind:class="{
                                                                            'progress-bar': true,
                                                                            'progress-bar-danger': tareaI.attributes.avance*1 <= 30,
                                                                            'progress-bar-warning': 30 < tareaI.attributes.avance*1 && tareaI.attributes.avance*1 < 70,
                                                                            'progress-bar-primary': 70 <= tareaI.attributes.avance*1
                                                                        }"></div>
                                                                    </div>
                                                                </td>
                                                                <td class="project-user">
                                                                    <i class="fa fa-user-o"></i> {{tareaI.relationships.usuario.attributes.nombres+' '+tareaI.relationships.usuario.attributes.apellidos}}
                                                                </td>
                                                                <td class="project-owner">
                                                                    <i class="fa fa-user-secret"></i> {{tareaI.relationships.creador.attributes.nombres+' '+tareaI.relationships.creador.attributes.apellidos}}
                                                                </td>
                                                                <td class="project-actions">
                                                                    <a href="#detalleTarea" class="btn btn-white btn-sm" v-on:click='seleccionaTarea(tareaI)'><i class="fa fa-folder"></i> Ver </a>
                                                                    <a v-if="tareaI.relationships.usuario.id==user.id" href="#registrarAvance" class="btn btn-white btn-sm" v-on:click='registrarAvanceTarea(tareaI)'><i class="fa fa-forward"></i> Avance </a>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </carouselitem>
                    <!--
                        Visualizar detalle de tarea
                    -->
                    <carouselitem id="detalleTarea">
                        <div class="row wrapper border-bottom page-heading">
                            <div class="wrapper wrapper-content">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="ibox">
                                            <div class="ibox-content">
                                                <div class="row">
                                                    <div class="col-lg-12">
                                                        <div class="m-b-md">
                                                            <a v-if="tarea.usuario_id==user.id" href="#registrarAvance" class="btn btn-success btn-xs pull-right" v-on:click="crearAvance">Registrar avance</a>
                                                            <h2>{{tarea.cod_tarea}} {{tarea.nombre_tarea}}</h2>
                                                        </div>
                                                        <dl class="dl-horizontal">
                                                            <dt>Estado:</dt> <dd><span class="label label-primary">{{tarea.estado}}</span></dd>
                                                            <div style="height: 4px;"></div>
                                                            <dt>Prioridad:</dt>
                                                            <dd>
                                                                <p class="small font-bold">
                                                                    <span><i v-bind:class="{'fa fa-circle':true, 'text-danger':tarea.prioridad=='Alta', 'text-warning':tarea.prioridad=='Media', 'text-primary':tarea.prioridad=='Baja'}"></i> {{tarea.prioridad}}</span>
                                                                </p>
                                                            </dd>
                                                        </dl>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-5">
                                                        <dl class="dl-horizontal">
                                                            <dt>Creado por:</dt> <dd>{{tarea.revisor1 ? tarea.revisor1.attributes.username : ''}}</dd>
                                                            <dt>Asignado a:</dt> <dd>{{typeof tarea.usuario=='object' && tarea.usuario ? (tarea.usuario.attributes ? tarea.usuario.attributes.username: tarea.usuario.username) : ''}}</dd>
                                                        </dl>
                                                    </div>
                                                    <div class="col-lg-7" id="cluster_info">
                                                        <dl class="dl-horizontal">

                                                            <dt>Creación:</dt> <dd>{{tarea.created_at}}</dd>
                                                            <dt>Última actualización:</dt> <dd>{{tarea.updated_at}}</dd>
                                                        </dl>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-12">
                                                        <dl class="dl-horizontal">
                                                            <dt>Avance:</dt>
                                                            <dd>
                                                                <div v-bind:class="{'progress progress-striped active m-b-sm': tarea.avance < 100, 'progress progress-bar-default': tarea.avance == 100 }">
                                                                    <div v-bind:style="{width: tarea.avance+'%'}" v-bind:class="{
                                                                         'progress-bar': true,
                                                                         'progress-bar-danger': tarea.avance <= 30,
                                                                         'progress-bar-warning': 30 < tarea.avance && tarea.avance < 70,
                                                                         'progress-bar-primary': 70 <= tarea.avance
                                                                    }"></div>
                                                                </div>
                                                                <small>
                                                                    El avance de la tarea es de <strong>{{tarea.avance}}%</strong>.
                                                                </small>
                                                            </dd>
                                                        </dl>
                                                    </div>
                                                </div>
                                                <div class="row m-t-sm">
                                                    <div class="col-lg-12">
                                                        <div class="panel blank-panel">
                                                            <div class="panel-heading">
                                                                <div class="panel-options">
                                                                    <ul class="nav nav-tabs">
                                                                        <li class="active"><a href="#tab-1" data-toggle="tab">Descripción</a></li>
                                                                        <li class=""><a href="#tab-2" data-toggle="tab">Actividades</a></li>
                                                                    </ul>
                                                                </div>
                                                            </div>

                                                            <div class="panel-body">

                                                                <div class="tab-content">
                                                                    <div class="tab-pane active" id="tab-1">
                                                                        <p>
                                                                            {{tarea.descripcion}}
                                                                        </p>
                                                                        <h5>Adjuntos</h5>
                                                                        <ul class="list-unstyled project-files">
                                                                            <li v-for="adjunto in tarea.adjuntos" v-if='adjunto.attributes.archivo'><a :href="adjunto.attributes.archivo?adjunto.attributes.archivo.url:''" target="_blank"><i class="fa fa-file"></i> {{adjunto.attributes.archivo?adjunto.attributes.archivo.name:''}}</a></li>
                                                                        </ul>
                                                                    </div>
                                                                    <div class="tab-pane" id="tab-2">

                                                                        <table class="table table-striped">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th>Avance</th>
                                                                                    <th>Fecha y Hora</th>
                                                                                    <th>Comentarios</th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                                <tr v-for="avance in tarea.avances">
                                                                                    <td>
                                                                                        <span class="label label-primary">{{avance.attributes.avance}}</span>
                                                                                    </td>
                                                                                    <td>
                                                                                        {{avance.attributes.created_at}}
                                                                                    </td>
                                                                                    <td>
                                                                                        <p class="small">
                                                                                            {{avance.attributes.descripcion}}
                                                                                        </p>
                                                                                    </td>

                                                                                </tr>
                                                                            </tbody>
                                                                        </table>

                                                                    </div>
                                                                </div>

                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </carouselitem>
                    <!--
                        Asignar una nueva tarea
                    -->
                    <carouselitem id="asignarTarea">
                        <div class="row wrapper border-bottom page-heading">
                            <div class="wrapper wrapper-content">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="ibox">
                                            <div class="ibox-title">
                                                <h5>Tarea</h5>
                                                <div class="ibox-tools">
                                                    <a href="#seguimientoDeTareas" class="btn btn-primary btn-xs" v-on:click='guardarTarea'>Guardar Tarea</a>
                                                </div>
                                            </div>
                                            <div class="ibox-content">
                                                <div class="row">
                                                    <div class="col-lg-12">
                                                        <dl class="dl-horizontal">
                                                            <dt>Código:</dt> <dd>(se generará al asignar la tarea)</dd>
                                                        </dl>
                                                        <dl class="dl-horizontal">
                                                            <dt>Tarea:</dt> <dd><input type="text" class="form-control" placeholder="tarea" v-model="tarea.nombre_tarea"></dd>
                                                        </dl>
                                                        <dl class="dl-horizontal">
                                                            <dt>Estado:</dt> <dd><span class="label label-primary">Pendiente</span></dd>
                                                        </dl>
                                                        <dl class="dl-horizontal">
                                                            <dt>Prioridad:</dt>
                                                            <dd>
                                                                <select class="form-control" placeholder="prioridad" v-model="tarea.prioridad">
                                                                    <option value="Baja">Baja</option>
                                                                    <option value="Media">Media</option>
                                                                    <option value="Alta">Alta</option>
                                                                </select>
                                                            </dd>
                                                        </dl>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-5">
                                                        <dl class="dl-horizontal">
                                                            <dt>Creado por:</dt> <dd>{{user.nombres + ' ' + user.apellidos}}</dd>
                                                        </dl>
                                                        <dl class="dl-horizontal">
                                                            <dt>Asignado a:</dt> <dd>
                                                                <select class="form-control" placeholder="asignado" v-model="tarea.usuario">
                                                                    <option v-for="user in users" v-bind:value="user.id">{{user.attributes.nombres+" "+user.attributes.apellidos}}</option>
                                                                </select>
                                                            </dd>
                                                        </dl>
                                                    </div>
                                                    <div class="col-lg-7" id="cluster_info">
                                                        <dl class="dl-horizontal">



                                                        </dl>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-12">
                                                        <dl class="dl-horizontal">
                                                            <dt>Avance:</dt>
                                                            <dd>
                                                                <div class="progress progress-striped active m-b-sm">
                                                                    <div v-bind:style="{width: tarea.avance+'%'}" class="progress-bar progress-bar-warning"></div>
                                                                </div>
                                                                <small>
                                                                    El avance de la tarea es de <strong>{{tarea.avance}}%</strong>.
                                                                </small>
                                                            </dd>
                                                        </dl>
                                                    </div>
                                                </div>
                                                <div class="row m-t-sm">
                                                    <div class="col-lg-12">
                                                        <div class="panel blank-panel">
                                                            <div class="panel-heading">
                                                                <div class="panel-options">
                                                                    <ul class="nav nav-tabs">
                                                                        <li class="active"><a href="#tab-1a" data-toggle="tab">Descripción</a></li>
                                                                        <li class=""><a href="#tab-2a" data-toggle="tab">Actividades</a></li>
                                                                    </ul>
                                                                </div>
                                                            </div>

                                                            <div class="panel-body">

                                                                <div class="tab-content">
                                                                    <div class="tab-pane active" id="tab-1a">
                                                                        <p>
                                                                            <textarea class="form-control" v-model="tarea.descripcion" placeholder="Descripción"></textarea>
                                                                        </p>
                                                                        <h5>Adjuntos</h5>
                                                                        <ul class="list-unstyled project-files">
                                                                            <li v-for="adjunto in tarea.adjuntos" v-if='adjunto.attributes.archivo'><a :href="adjunto.attributes.archivo?adjunto.attributes.archivo.url:''" target="_blank"><i class="fa fa-file"></i> {{adjunto.attributes.archivo?adjunto.attributes.archivo.name:''}}</a></li>
                                                                        </ul>
                                                                        <div class="text-center m-t-md">

                                                                        </div>

                                                                    </div>
                                                                    <div class="tab-pane" id="tab-2a">

                                                                        <table class="table table-striped">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th>Avance</th>
                                                                                    <th>Fecha y Hora</th>
                                                                                    <th>Comentarios</th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                                <tr v-for="avance in tarea.avances">
                                                                                    <td>
                                                                                        <span class="label label-primary">{{avance.attributes.avance}}</span>
                                                                                    </td>
                                                                                    <td>
                                                                                        {{avance.attributes.created_at}}
                                                                                    </td>
                                                                                    <td>
                                                                                        <p class="small">
                                                                                            {{avance.attributes.descripcion}}
                                                                                        </p>
                                                                                    </td>

                                                                                </tr>
                                                                            </tbody>
                                                                        </table>

                                                                    </div>
                                                                </div>

                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </carouselitem>
                    <!--
                        Registrar avance de tarea
                    -->
                    <carouselitem id="registrarAvance">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="wrapper wrapper-content animated fadeInUp">
                                    <div class="ibox">
                                        <div class="ibox-content">
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <div class="m-b-md">
                                                        <a href="javascript:history.back()" class="btn btn-success btn-xs pull-right" v-on:click="guardarAvance">Guardar avance</a>
                                                        <h2>{{tarea.cod_tarea}} {{tarea.nombre_tarea}}</h2>
                                                    </div>
                                                    <dl class="dl-horizontal">
                                                        <dt>Estado:</dt> <dd><span class="label label-primary">{{tarea.estado}}</span></dd>
                                                        <div style="height: 4px;"></div>
                                                        <dt>Prioridad:</dt>
                                                        <dd>
                                                            <p class="small font-bold">
                                                                <span><i v-bind:class="{'fa fa-circle':true, 'text-danger':tarea.prioridad=='Alta', 'text-warning':tarea.prioridad=='Media', 'text-primary':tarea.prioridad=='Baja'}"></i> {{tarea.prioridad}}</span>
                                                            </p>
                                                        </dd>
                                                    </dl>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-5">
                                                    <dl class="dl-horizontal">
                                                        <dt>Creado por:</dt> <dd>{{tarea.revisor1 ? tarea.revisor1.attributes.username : ''}}</dd>
                                                        <dt>Asignado a:</dt> <dd>{{typeof tarea.usuario=='object' && tarea.usuario ? (tarea.usuario.attributes ? tarea.usuario.attributes.username: tarea.usuario.username) : ''}}</dd>
                                                    </dl>
                                                </div>
                                                <div class="col-lg-7" id="cluster_info">
                                                    <dl class="dl-horizontal">

                                                        <dt>Creación:</dt> <dd>{{tarea.created_at}}</dd>
                                                        <dt>Última actualización:</dt> <dd>{{tarea.updated_at}}</dd>
                                                    </dl>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <dl class="dl-horizontal">
                                                        <dt>Avance:</dt>
                                                        <dd>
                                                            <input type="number" min="0" max="100" class="form-control" placeholder="avance" v-model="avance.avance">
                                                        </dd>
                                                    </dl>
                                                    <dl class="dl-horizontal">
                                                        <dt>Comentario de avance:</dt>
                                                        <dd>
                                                            <textarea class="form-control" v-model="avance.descripcion" placeholder="Descripción"></textarea>
                                                        </dd>
                                                    </dl>
                                                </div>
                                            </div>
                                            <div class="row m-t-sm">
                                                <div class="col-lg-12">
                                                    <div class="panel blank-panel">
                                                        <div class="panel-heading">
                                                            <div class="panel-options">
                                                                <ul class="nav nav-tabs">
                                                                    <li class="active"><a href="#tab-1b" data-toggle="tab">Descripción</a></li>
                                                                    <li class=""><a href="#tab-2b" data-toggle="tab">Actividades</a></li>
                                                                </ul>
                                                            </div>
                                                        </div>

                                                        <div class="panel-body">

                                                            <div class="tab-content">
                                                                <div class="tab-pane active" id="tab-1b">
                                                                    <p>
                                                                        {{tarea.descripcion}}
                                                                    </p>
                                                                    <h5>Adjuntos</h5>
                                                                    <ul class="list-unstyled project-files">
                                                                        <li v-for="adjunto in tarea.adjuntos" v-if='adjunto.attributes.archivo'><a :href="adjunto.attributes.archivo?adjunto.attributes.archivo.url:''" target="_blank"><i class="fa fa-file"></i> {{adjunto.attributes.archivo?adjunto.attributes.archivo.name:''}}</a></li>
                                                                    </ul>
                                                                    <dv-form :model="Adjunto" v-on:custom="adjuntarArchivo" buttons="Adjuntar"></dv-form>
                                                                </div>
                                                                <div class="tab-pane" id="tab-2b">

                                                                    <table class="table table-striped">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>Avance</th>
                                                                                <th>Fecha y Hora</th>
                                                                                <th>Comentarios</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            <tr v-for="avance in tarea.actividades">
                                                                                <td>
                                                                                    <span class="label label-primary">{{avance.attributes.avance}}</span>
                                                                                </td>
                                                                                <td>
                                                                                    {{avance.attributes.created_at}}
                                                                                </td>
                                                                                <td>
                                                                                    <p class="small">
                                                                                        {{avance.attributes.descripcion}}
                                                                                    </p>
                                                                                </td>

                                                                            </tr>
                                                                        </tbody>
                                                                    </table>

                                                                </div>
                                                            </div>

                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </carouselitem>
                    <carouselitem id="informesDeAuditoriaYSeguimientos">
                        <div class="row">
                            <div class="col-lg-12">
                            </div>
                        </div>
                    </carouselitem>
                    <carouselitem id="PEIyPOA">
                        <div class="row wrapper border-bottom page-heading">
                            <div class="wrapper wrapper-content">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="ibox">
                                            <div class="ibox-content">
                                                <br><br>
                                                <h3><a href="pei_scep.pdf" target="_blank"><i class="fa fa-file-pdf-o"></i> Plan Estrategico Institucional (PEI)</a></h3>
                                                <p>Objetivos del Plan Estratégicos Institucional “PEI” del MEFP y su Contribución ..... el MEFP.
                                                    Hacer un seguimiento y control al PEI y al POA con incidencia en la.</p>
                                                <br>
                                                <h3><a href="poa_scep.pdf" target="_blank"><i class="fa fa-file-pdf-o"></i> Plan Operativo Anual (POA)</a></h3>
                                                <p>Objetivos del Plan Estratégicos Institucional “PEI” del MEFP y su Contribución ..... el MEFP.
                                                    Hacer un seguimiento y control al PEI y al POA con incidencia en la.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </carouselitem>
                    <carouselitem id="cambio_password">
                        <div class="row wrapper border-bottom page-heading">
                            <div class="wrapper wrapper-content">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="ibox">
                                            <div class="ibox-title">
                                                <h5>CAMBIO DE CONTRASEÑA</h5>
                                                <div class="ibox-tools">
                                                    <a href="#seguimientoDeTareas" class="btn btn-primary btn-xs" v-on:click='guardarTarea'>Guardar Tarea</a>
                                                </div>
                                            </div>
                                            <div class="ibox-content">
                                                <div class="row">
                                                    <div class="col-sm-6 col-sm-offset-3">
                                                        <p class="text-center">Introdusca en los siguientes campos su nueva contraseña:</p>
                                                        <form method="post" id="passwordForm">
                                                            <input type="password" class="input-lg form-control" v-model="password1" placeholder="Nueva contraseña" autocomplete="off">
                                                            <input type="password" class="input-lg form-control" v-model="password2" placeholder="Repetir la contraseña" autocomplete="off">
                                                            <div class="row">
                                                                <div class="col-sm-12">
                                                                    <span id="pwmatch" v-bind:class="{glyphicon:true, 'glyphicon-remove':password1!=password2 || password2=='', 'glyphicon-ok':password1==password2 && password2!=''}" v-bind:style="{color:password1!=password2 || password2==''?'#FF0004':'rgb(0, 164, 30)'}"></span> Contraseñas coinciden
                                                                </div>
                                                            </div>
                                                            <input type="button" class="col-xs-12 btn btn-primary btn-load btn-lg" data-loading-text="Cambiando contraseña..." value="Cambiar contraseña" v-on:click="cambiarPassword" v-bind:disabled="password1!=password2 || password2==''">
                                                        </form>
                                                    </div><!--/col-sm-6-->
                                                </div><!--/row-->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </carouselitem>
                </carousel>


            </div>         

        </div>

        <!-- Mainly scripts -->
        <script src="../js/server.js?v0.61"></script>
        <script>
        $(document).ready(function () {
            var app;
            app = new Vue({
                el: '#wrapper',
                carousel: {},
                tareaAvance: 0,
                data: function () {
                    var self = this;
                    return {
                        user: new UserAdministration.User("/api/UserAdministration/users", localStorage.user_id),
                        usertarea: new UserAdministration.User(),
                        users: [],
                        empresas: [],
                        empresa: new UserAdministration.Empresa(),
                        empresa_estado: new UserAdministration.EmpresaEstado(),
                        estado_financiero_aux: new UserAdministration.EstadoFinanciero(),
                        estado_financiero_adm: new UserAdministration.EstadoFinanciero(),
                        firma_auditoria: new UserAdministration.Firma(function(){return "/api/UserAdministration/users/"+localStorage.user_id+"/firmas";}),
                        uai: new UserAdministration.Uai(function(){return "/api/UserAdministration/users/"+localStorage.user_id+"/uais";}),
                        tarea: new UserAdministration.Tarea(),
                        avance: new UserAdministration.Avance(function(){return app.tarea && app.tarea.id? ("/api/UserAdministration/tareas/"+app.tarea.id+"/avances") : "/api/UserAdministration/avances"}),
                        estados_financieros: [],
                        Adjunto: new UserAdministration.Adjunto(function(){return app.tarea && app.tarea.id? ("/api/UserAdministration/tareas/"+app.tarea.id+"/adjuntos") : "/api/UserAdministration/adjuntos"}),
                        PathItem: [],
                        busquedaTareas: '',
                        tareasTodas: [],
                        tareas: [],
                        empresaSeleccionada: "1",
                        empresaSeleccionadaId: "",
                        graficos:[],
                        graficoModel: new UserAdministration.EmpresaGrafico(function(){return self.empresaSeleccionadaId? ("/api/UserAdministration/empresas/"+self.empresaSeleccionadaId+"/graficos") : "/api/UserAdministration/EmpresaGraficos"}),
                        empresaSeleccionadaGestion: '2017',
                        eeffEditable: [],
                        cuadro_financiero: new UserAdministration.CuadroFinanciero(),
                        cuadros_financieros: [],
                        editingEmpresa: true,
                        carga_estado: new UserAdministration.CargaEstado,
                        password1: '',
                        password2: '',
                    };
                },
                computed: {
                },
                methods: {
                    seleccionaEmpresa: function () {
                        window.location.hash = '#descripcionEmpresa';
                        $('#descripcionEmpresa')[0].scrollIntoView(true);
                    },
                    listarTareas: function () {
                        var self = this;
                        this.tarea.$select(
                            function (data) {
                                self.tareasTodas.splice(0);
                                data.data.forEach(function (row) {
                                    self.tareasTodas.push(row);
                                });
                                self.pintarTareas();
                            },
                            {
                                filter:[
                                    'where,usuario_id,=,'+localStorage.user_id,
                                    'orWhere,creador_id,=,'+localStorage.user_id,
                                ]
                            }
                        );
                    },
                    loadListTo: function (from, to) {
                        var self = this;
                        to.splice(0);
                        from.$select(function (data) {
                            data.data.forEach(function (row) {
                                to.push(row);
                            });
                        });
                    },
                    listarEmpresas: function () {
                        var self = this;
                        self.empresas.splice(0);
                        self.empresa.$select(function (data) {
                            data.data.forEach(function (row) {
                                self.empresas.push(row);
                            });
                        });
                    },
                    pintarTareas: function () {
                        var self = this;
                        self.tareas.splice(0);
                        var limit = 50;
                        self.tareasTodas.forEach(function (row) {
                            if (self.tareas.length>=limit) {
                                return;
                            }
                            if (self.busquedaTareas) {
                                for(var att in row.attributes) {
                                    var val = row.attributes[att];
                                    if (
                                        (val && typeof val.indexOf==='function' &&
                                        val.indexOf(self.busquedaTareas)!==-1) ||
                                        val==self.busquedaTareas
                                    ) {
                                        self.tareas.push(row);
                                        break;
                                    }
                                }
                            } else {
                                self.tareas.push(row);
                            }
                        });
                    },
                    seleccionaTarea: function (tarea) {
                        this.tarea.$load(tarea.id);
                    },
                    crearTarea: function () {
                        this.tarea.$load(0);
                    },
                    guardarTarea: function () {
                        var self = this;
                        self.tarea.creador = {id:localStorage.user_id};
                        this.tarea.$save('', function() {
                            self.listarTareas();
                        });
                    },
                    crearAvance: function () {
                        var self = this;
                        self.avance.$load(0, function () {
                            self.avance.avance = self.tarea.avance;
                        });
                    },
                    guardarAvance: function () {
                        var self = this;
                        this.avance.tarea_id = this.tarea.id;
                        this.avance.$save('', function() {
                            self.listarTareas();
                            self.tarea.$load(self.tarea.id);
                        });
                    },
                    registrarAvanceTarea: function (tarea) {
                        var self = this;
                        self.tarea.$load(tarea.id, function () {
                            self.avance.$load(0, function () {
                                self.avance.avance = self.tarea.avance;
                            });
                        });
                    },
                    adjuntarArchivo: function () {
                        var self = this;
                        this.Adjunto.$save('', function () {
                            self.Adjunto.$load(0);
                            self.tarea.$load(self.tarea.id);
                        });
                    },
                    abrirUAI: function () {
                        $("#abmUAI").get(0).__vue__.goto(0);
                    },
                    abrirFirmasDeAuditoria: function () {
                        $("#abmFirmasDeAuditoria").get(0).__vue__.goto(0);
                    },
                    buscarTarea: function () {
                        this.pintarTareas();
                    },
                    cargarEstadosFinancieros: function () {
                        var self = this;
                        //indicators:
                        self.cargarCuadrosFinancieros();
                        //charts:
                        var model = new UserAdministration.EstadoFinanciero("/api/UserAdministration/estado_financieros");
                        model.$select(function (resultado) {
                            app.estados_financieros.splice(0);
                            resultado.data.forEach(function (row) {
                                app.estados_financieros.push(row);
                            });
                            Vue.nextTick(function () {
                                $("span.peityChart").each(function () {
                                    var chart = $(this).attr("chart") ? $(this).attr("chart") : 'pie';
                                    $(this).peity(chart, {
                                        fill: chart === 'pie' || chart === 'bar' ? ['#1ab394', '#d7d7d7', '#8CD9C9'] : '#1ab394',
                                        width: 80,
                                        height: 80
                                    })
                                });
                            });
                        },
                        {
                            'filter':[
                                'where,empresa_id,=,'+self.empresaSeleccionada,
                                'where,gestion,=,'+self.empresaSeleccionadaGestion,
                            ]
                        });
                    },
                    addCommas: function (nStr)
                    {
                        nStr += '';
                        x = nStr.split('.');
                        x1 = x[0];
                        x2 = x.length > 1 ? '.' + x[1] : '';
                        var rgx = /(\d+)(\d{3})/;
                        while (rgx.test(x1)) {
                            x1 = x1.replace(rgx, '$1' + ',' + '$2');
                        }
                        return x1 + x2;
                    },
                    /**
                     * Carga los cuadros de estados financieros.
                     *
                     */
                    cargarCuadrosFinancieros: function () {
                        var self = this;
                        var model = self.cuadro_financiero;
                        model.$select(function (resultado) {
                            app.cuadros_financieros.splice(0);
                            resultado.data.forEach(function (row) {
                                row.html = '';
                                self.cuadro_financiero.$methods.calculate(
                                    self.empresaSeleccionada,
                                    self.empresaSeleccionadaGestion,
                                    row.attributes.contenido,
                                    row.attributes.grafico,
                                    function (html) {
                                        row.html = html[0];
                                        row.calculatedChart = JSON.parse(html[1]);
                                        Vue.nextTick(function () {
                                            document.getElementById('estadosFinancieros').__vue__.$children.forEach(function(comp) {
                                                try {
                                                    comp.refresh();
                                                } catch(ee){}
                                            });
                                        });
                                    }
                                );
                                app.cuadros_financieros.push(row);
                            });
                        },
                        {
                            sort: "titulo"
                        });
                    },
                    /**
                     * Habilita el modo edición de un estado financiero.
                     *
                     */
                    editEEFF: function (estado) {
                        var self=this;
                        self.eeffEditable.push(estado.id);
                    },
                    saveEEFF: function (estado) {
                        var self=this;
                        self.cuadro_financiero.$load(estado.id, function () {
                            self.cuadro_financiero.contenido = estado.attributes.contenido;
                            self.cuadro_financiero.$save();
                            estado.html = '';
                            self.cuadro_financiero.$methods.calculate(
                                self.empresaSeleccionada,
                                self.empresaSeleccionadaGestion,
                                estado.attributes.contenido,
                                function (html) {
                                    estado.html = html;
                                }
                            );
                            var i = self.eeffEditable.indexOf(estado.id);
                            self.eeffEditable.splice(i,1);
                        });
                    },
                    editableEEFF: function (estado) {
                        var self=this;
                        return self.eeffEditable.indexOf(estado.id)>-1;
                    },
                    /**
                     * Agrega un cuadro de estado financiero.
                     */
                    addCCFF: function () {
                        var self=this;
                        self.cuadro_financiero.$create(function(estado) {
                            estado.titulo = prompt('Nombre del cuadro');
                            estado.contenido = '<table width="100%"><tbody><tr><td style="background-color: #a4a5d5; color: white;" rowspan="2"><h1 style="text-align: center;">{{$uc(\'1\')}}</h1><p style="text-align: center;">ACTIVO</p></td><td style="background-color: #d14550; color: white;"><h2 style="text-align: center;">{{$uc(\'2\')}}</h2><p style="text-align: center;">PASIVO</p></td></tr><tr><td style="background-color: #19a3ab; color: white;"><h2 style="text-align: center;">{{$uc(\'3\')}}</h2><p style="text-align: center;">PATRIMONIO</p></td></tr></tbody></table>';
                            estado.$save('', function() {
                                self.cargarCuadrosFinancieros();
                            });
                        });
                    },
                    editEmpresa: function () {
                        var self = this;
                        self.editingEmpresa = true;
                    },
                    saveEmpresa: function (empresa) {
                        var self = this;
                        self.editingEmpresa = false;
                        empresa.$save();
                    },
                    /**
                     * Cambia la contraseña deñ usuario actual.
                     */
                    cambiarPassword: function () {
                        var self = this;
                        self.user.password=self.password1;
                        self.user.$save();
                        window.location.href="login.html";
                    },
                },
                mounted: function () {
                    var self = this;
                    this.carousel = this.$children[0];
                    $("#now_loading").hide();
                    $(this.$el).css("visibility", "visible");
                    var hash0 = location.hash;
                    location.hash = '';
                    location.hash = hash0;
                    this.listarTareas();
                    this.listarEmpresas();
                    this.cargarEstadosFinancieros();
                    this.cargarCuadrosFinancieros();
                    this.loadListTo(this.usertarea, this.users);
                }
            });
            window.app = app;
            $(window).on('hashchange', function() {
                $("body").removeClass("mini-navbar");
            });
        });
        </script>
        <!-- Peity -->
        <script src="js/plugins/peity/jquery.peity.min.js"></script>

        <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
        <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
        <script src="js/inspinia.js"></script>
    </body>
</html>
