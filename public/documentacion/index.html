<!DOCTYPE html>
<html>

    <head>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">

        <title>SCEP</title>

        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="font-awesome/css/font-awesome.css" rel="stylesheet">

        <!-- Toastr style -->
        <link href="css/plugins/toastr/toastr.min.css" rel="stylesheet">

        <!-- Gritter -->
        <link href="js/plugins/gritter/jquery.gritter.css" rel="stylesheet">

        <link href="css/animate.css" rel="stylesheet">
        <link href="css/style.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/css/buttons.dataTables.min.css">
        <link rel="stylesheet" type="text/css" href="/bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="/bower_components/datatables.net-responsive-bs/css/responsive.bootstrap.min.css">

    </head>

    <body>
        <div id="now_loading">
            Cargando ...<br/>
            <i class="ajax-loader"></i>
        </div>
        <div id="wrapper" style="visibility:hidden">
            <nav class="navbar-default navbar-static-side" role="navigation">
                <div class="sidebar-collapse">
                    <ul class="nav metismenu" id="side-menu">
                        <li class="nav-header">
                            <div class="dropdown profile-element"> 
                                <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                                    <span class="clear"> <span class="block m-t-xs"> <strong class="font-bold">{{user.username}}</strong>
                                        </span> <span class="text-muted text-xs block">Usuario<b class="caret"></b></span> </span> </a>
                                <ul class="dropdown-menu animated fadeInRight m-t-xs">
                                    <li><a href="profile.html">Perfil</a></li>
                                    <li><a href="contacts.html">Contactos</a></li>
                                    <li><a href="mailbox.html">Correo</a></li>
                                    <li class="divider"></li>
                                    <li><a href="login.html">Salir</a></li>
                                </ul>
                            </div>
                            <div class="logo-element">
                                SCEP
                            </div>
                        </li>
                        <li class="active">
                            <a href="index.html"><i class="fa fa-th-large"></i> <span class="nav-label">Cuadros de mando</span> <span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level">
                                <li class="active"><a href="#empresasPublicas">Empresas públicas</a></li>
                                <li class="active"><a href="#estadosFinancieros">Estados financieros</a></li>
                                <li class="active"><a href="#documentos">Documentos</a></li>
                                <li class="active"><a href="#UAI">UAI</a></li>
                                <li class="active"><a href="#firmasDeAuditoria">Firmas de auditoria</a></li>
                                <li class="active"><a href="#informesDeAuditoriaYSeguimientos">Informes de Auditoria y seguimientos</a></li>
                                <li class="active"><a href="#PEIyPOA">PEI y POA</a></li>
                                <li class="active"><a href="#seguimientoDeTareas">Seguimiento de tareas</a></li>
                            </ul>
                        </li>
                        <li class="active">
                            <a href="index.html"><i class="fa fa-th-large"></i> <span class="nav-label">Admin</span> <span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level">
                                <li class="active"><a href="#estadosFinancierosAdmin">Estados financieros ADM</a></li>
                            </ul>
                        </li>
                    </ul>

                </div>
            </nav>

            <div id="page-wrapper" class="gray-bg dashbard-1">
                <div class="row border-bottom">
                    <nav role="navigation" class="navbar navbar-static-top" style="margin-bottom: 0px;"><div class="navbar-header"><a href="#" class="navbar-minimalize minimalize-styl-2 btn btn-primary "><i class="fa fa-bars"></i></a></div> <ul class="nav navbar-top-links navbar-right"><li></li>   <li><a href="login.html"><i class="fa fa-sign-out"></i>Cerrar Sesión</a></li> </ul></nav>
                </div>
                <carousel>
                    <!--
                        EMPRESAS PUBLICAS
                    -->
                    <carouselitem id="empresasPublicas" class="active">
                        <div class="row wrapper border-bottom white-bg page-heading">
                            <div class="col-lg-10">
                                <h2>Detalle Empresas Públicas </h2>
                            </div>
                            <div class="wrapper wrapper-content">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="ibox float-e-margins">
                                            <div class="ibox-content">
                                                <div class="table-responsive" style="overflow-y: scroll;">

                                                    <abm v-bind:model="empresa" v-bind:editable="false" toolbar="excel,pdf,search" v-on:selectrow="seleccionaEmpresa"></abm>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class="row">
                                    <div id="descripcionEmpresa" class="col-lg-12">
                                        <div class="ibox float-e-margins">
                                            <div class="col-lg-12">
                                                <div class="ibox">
                                                    <div class="ibox-title">
                                                        <h5> {{empresa.nombre_empresa}}</h5>
                                                    </div>
                                                    <div class="ibox-content" v-html="empresa.detalle_empresa">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </carouselitem>

                    <!--
                        ESTADOS FINANCIEROS
                    -->
                    <carouselitem id="estadosFinancieros">
                        <div class="row wrapper border-bottom white-bg page-heading">
                            <div class="col-lg-10">
                                <h2>Estados financieros </h2>
                            </div>
                            <div class="wrapper wrapper-content">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="ibox float-e-margins">
                                            <div class="ibox-content">
                                                <div class="table-responsive" style="overflow-y: scroll;">
                                                    <abm id="empresa_estado" v-bind:model="empresa_estado" v-bind:editable="false" v-on:selectrow="cargarEstadosFinancieros" toolbar="excel,pdf,search"></abm>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class="row">
                                    <div id="documentosEstadosFinancieros" class="col-lg-12">
                                        <!-- FOR (estado  in  estados_financieros)-->
                                        <div class="row m-b-lg m-t-lg" v-for="estado in estados_financieros">
                                            <div class="col-md-6">

                                                <div class="profile-image">
                                                    <h1 style='text-align: center;'><i class="fa fa-file-excel-o"></i></h1>
                                                </div>
                                                <div class="profile-info">
                                                    <div class="">
                                                        <div>
                                                            <h2 class="no-margins">
                                                                {{estado.attributes.archivo?estado.attributes.archivo.name:''}}
                                                            </h2>
                                                            <a v-bind:href="estado.attributes.archivo?estado.attributes.archivo.url:'#'" class="" target="_blank"><i class="fa fa-download "></i> descargar</a>
                                                            <small>
                                                                {{estado.attributes.informes_auditoria}}
                                                            </small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3" v-if="!!estado.attributes.grafico_valores">
                                                <table class="table small m-b-xs">
                                                    <tbody>
                                                        <tr v-for="(texto,indice) in estado.attributes.grafico_texto.split(',')">
                                                            <td>
                                                                <strong>{{texto.split("|")[0]}}</strong>
                                                            </td>
                                                            <td>
                                                                {{addCommas(estado.attributes.grafico_valores.split(',')[indice])}}
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <div class="col-md-3" v-if="!!estado.attributes.grafico_valores">
                                                <span class="peityChart" v-bind:chart="estado.attributes.grafico_texto.split('|')[1]" style="width:64px; height: 64px;">{{estado.attributes.grafico_valores}}</span>
                                            </div>
                                        </div>                                        
                                    </div>

                                </div>
                            </div>
                        </div>
                    </carouselitem>
                    <!--
                        ESTADOS FINANCIEROS ADMIN
                    -->
                    <carouselitem id="estadosFinancierosAdmin">
                        <div class="row wrapper border-bottom white-bg page-heading">
                            <div class="col-lg-10">
                                <h2>Estados financieros ADMIN</h2>
                            </div>
                            <div class="wrapper wrapper-content">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="ibox float-e-margins">
                                            <div class="ibox-content">
                                                <div class="table-responsive" style="overflow-y: scroll;">
                                                    <abm v-bind:model="estado_financiero_aux" v-bind:editable="true" v-on:selectrow="cargarEstadosFinancieros"></abm>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </carouselitem>
                </carousel>


            </div>         

        </div>

        <!-- Mainly scripts -->
        <script src="../js/server.js?v7"></script>
        <script>
$(document).ready(function () {
    var app = new Vue({
        el: '#wrapper',
        carousel: {},
        data: function () {
            var self = this;
            return {
                user: new UserAdministration.User("/api/UserAdministration/users", localStorage.user_id),
                empresa: new UserAdministration.Empresa(),
                empresa_estado: new UserAdministration.EmpresaEstado(),
                estado_financiero_aux: new UserAdministration.EstadoFinanciero(),//(function(){try{var url="/api/UserAdministration/empresa/"+(app.empresa_estado.id?app.empresa_estado.id:"¡@!")+"/estados";return API_SERVER+(url.indexOf("¡@!")===-1?url:this.$defaultUrl);}catch(err){return API_SERVER+this.$defaultUrl;}}),
                estados_financieros: [],
                PathItem: [],
            };
        },
        methods: {
            seleccionaEmpresa: function () {
                window.location.hash='#descripcionEmpresa';
            },
            cargarEstadosFinancieros: function() {
                var model = new UserAdministration.EstadoFinanciero("/api/UserAdministration/empresa_estados/"+app.empresa_estado.id+"/estados");
                model.$select(function(resultado){
                    app.estados_financieros.splice(0);
                    resultado.data.forEach(function(row){
                        app.estados_financieros.push(row);
                    });
                    Vue.nextTick(function () {
                        $("span.peityChart").each(function(){
                            $(this).peity($(this).attr("chart")?$(this).attr("chart"):'pie', {
                                fill: ['#1ab394', '#d7d7d7', '#8CD9C9'],
                                width: 80,
                                height: 80
                            })
                        });
                    });
                });
            },
            addCommas: function(nStr)
            {
                nStr += '';
                x = nStr.split('.');
                x1 = x[0];
                x2 = x.length > 1 ? '.' + x[1] : '';
                var rgx = /(\d+)(\d{3})/;
                while (rgx.test(x1)) {
                    x1 = x1.replace(rgx, '$1' + ',' + '$2');
                }
                return x1 + x2;
            }
        },
        mounted: function () {
            this.carousel = this.$children[0];
            $("#now_loading").hide();
            $(this.$el).css("visibility", "visible");
            location.hash='';
        }
    });
    window.app = app;
});
    </script>
        <!-- Peity -->
        <script src="js/plugins/peity/jquery.peity.min.js"></script>

        <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
        <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
        <script src="js/inspinia.js"></script>
    </body>
</html>
