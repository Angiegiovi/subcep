<!DOCTYPE html>
<html>

    <head>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">

        <title>SCEP</title>

        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="font-awesome/css/font-awesome.css" rel="stylesheet">

        <!-- Toastr style -->
        <link href="css/plugins/toastr/toastr.min.css" rel="stylesheet">

        <!-- Gritter -->
        <link href="js/plugins/gritter/jquery.gritter.css" rel="stylesheet">

        <link href="css/animate.css" rel="stylesheet">
        <link href="css/style.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/css/buttons.dataTables.min.css">
        <link rel="stylesheet" type="text/css" href="/bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="/bower_components/datatables.net-responsive-bs/css/responsive.bootstrap.min.css">

    </head>

    <body>
        <div id="now_loading">
            Cargando ...<br/>
            <i class="ajax-loader"></i>
        </div>
        <div id="wrapper" style="visibility:hidden">
            <nav class="navbar-default navbar-static-side" role="navigation">
                <div class="sidebar-collapse">
                    <ul class="nav metismenu" id="side-menu">
                        <li class="nav-header">
                            <div class="dropdown profile-element"> 
                                <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                                    <span class="clear"> <span class="block m-t-xs"> <strong class="font-bold">{{user.username}}</strong>
                                        </span> <span class="text-muted text-xs block">Usuario<b class="caret"></b></span> </span> </a>
                                <ul class="dropdown-menu animated fadeInRight m-t-xs">
                                    <li><a href="profile.html">Perfil</a></li>
                                    <li><a href="contacts.html">Contactos</a></li>
                                    <li><a href="mailbox.html">Correo</a></li>
                                    <li class="divider"></li>
                                    <li><a href="login.html">Salir</a></li>
                                </ul>
                            </div>
                            <div class="logo-element">
                                SCEP
                            </div>
                        </li>
                        <li class="active">
                            <a href="index.html"><i class="fa fa-th-large"></i> <span class="nav-label">Cuadros de mando</span> <span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level">
                                <li class="active"><a href="#empresasPublicas">Empresas públicas</a></li>
                                <li class="active"><a href="#estadosFinancieros">Estados financieros</a></li>
                                <li class="active"><a href="#UAI" v-on:click="abrirUAI">UAI</a></li>
                                <li class="active"><a href="#firmasDeAuditoria" v-on:click="abrirFirmasDeAuditoria">Firmas de auditoria</a></li>
                                <li class="active"><a href="#informesDeAuditoriaYSeguimientos">Informes de Auditoria y seguimientos</a></li>
                                <li class="active"><a href="#PEIyPOA">PEI y POA</a></li>
                                <li class="active"><a href="#seguimientoDeTareas">Seguimiento de tareas</a></li>
                            </ul>
                        </li>
                        <li class="active">
                            <a href="index.html"><i class="fa fa-th-large"></i> <span class="nav-label">Admin</span> <span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level">
                                <li class="active"><a href="#estadosFinancierosAdmin">Estados financieros ADM</a></li>
                            </ul>
                        </li>
                    </ul>

                </div>
            </nav>

            <div id="page-wrapper" class="gray-bg dashbard-1">
                <div class="row border-bottom">
                    <nav role="navigation" class="navbar navbar-static-top" style="margin-bottom: 0px;"><div class="navbar-header"><a href="#" class="navbar-minimalize minimalize-styl-2 btn btn-primary "><i class="fa fa-bars"></i></a></div> <ul class="nav navbar-top-links navbar-right"><li></li>   <li><a href="login.html"><i class="fa fa-sign-out"></i>Cerrar Sesión</a></li> </ul></nav>
                </div>
                <carousel>
                    <!--
                        EMPRESAS PUBLICAS
                    -->
                    <carouselitem id="empresasPublicas" class="active">
                        <div class="row wrapper border-bottom white-bg page-heading">
                            <div class="col-lg-10">
                                <h2>Detalle Empresas Públicas </h2>
                            </div>
                            <div class="wrapper wrapper-content">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="ibox float-e-margins">
                                            <div class="ibox-content">
                                                <div class="table-responsive" style="overflow-y: scroll;">

                                                    <abm v-bind:model="empresa" v-bind:editable="false" toolbar="pdf,search" v-on:selectrow="seleccionaEmpresa"></abm>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class="row">
                                    <div id="descripcionEmpresa" class="col-lg-12">
                                        <div class="ibox float-e-margins">
                                            <div class="col-lg-12">
                                                <div class="ibox">
                                                    <div class="ibox-title">
                                                        <h5> {{empresa.nombre_empresa}}</h5>
                                                    </div>
                                                    <div class="ibox-content" v-html="empresa.detalle_empresa">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </carouselitem>

                    <!--
                        ESTADOS FINANCIEROS
                    -->
                    <carouselitem id="estadosFinancieros">
                        <div class="row wrapper border-bottom white-bg page-heading">
                            <div class="col-lg-10">
                                <h2>Estados financieros </h2>
                            </div>
                            <div class="wrapper wrapper-content">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="ibox float-e-margins">
                                            <div class="ibox-content">
                                                <div class="table-responsive" style="overflow-y: scroll;">
                                                    <abm id="empresa_estado" v-bind:model="empresa_estado" v-bind:editable="false" v-on:selectrow="cargarEstadosFinancieros" toolbar="search"></abm>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class="row">
                                    <div id="documentosEstadosFinancieros" class="col-lg-12">
                                        <!-- FOR (estado  in  estados_financieros)-->
                                        <div class="row m-b-lg m-t-lg" v-for="estado in estados_financieros">
                                            <div class="col-md-6">

                                                <div class="profile-image">
                                                    <h1 style='text-align: center;'><i class="fa fa-file-excel-o"></i></h1>
                                                </div>
                                                <div class="profile-info">
                                                    <div class="">
                                                        <div>
                                                            <h2 class="no-margins">
                                                                {{estado.attributes.archivo?estado.attributes.archivo.name:''}}
                                                            </h2>
                                                            <p><a v-bind:href="estado.attributes.archivo?estado.attributes.archivo.url:'#'" class="" target="_blank"><i class="fa fa-download "></i> descargar</a></p>
                                                            <p>
                                                                <b>Informes de auditoria:</b>
                                                                {{estado.attributes.informes_auditoria}}
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3" v-if="!!estado.attributes.grafico_valores">
                                                <table class="table small m-b-xs">
                                                    <tbody>
                                                        <tr v-for="(texto,indice) in estado.attributes.grafico_texto.split(',')">
                                                            <td>
                                                                <strong>{{texto.split("|")[0]}}</strong>
                                                            </td>
                                                            <td>
                                                                {{addCommas(estado.attributes.grafico_valores.split(',')[indice])}}
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <div class="col-md-3" v-if="!!estado.attributes.grafico_valores">
                                                <span class="peityChart" v-bind:chart="estado.attributes.grafico_texto.split('|')[1]" style="width:64px; height: 64px;">{{estado.attributes.grafico_valores}}</span>
                                            </div>
                                        </div>                                        
                                    </div>

                                </div>
                            </div>
                        </div>
                    </carouselitem>
                    <!--
                        ESTADOS FINANCIEROS ADMIN
                    -->
                    <carouselitem id="estadosFinancierosAdmin">
                        <div class="row wrapper border-bottom white-bg page-heading">
                            <div class="col-lg-10">
                                <h2>Estados financieros ADMIN</h2>
                            </div>
                            <div class="wrapper wrapper-content">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="ibox float-e-margins">
                                            <div class="ibox-content">
                                                <div class="table-responsive" style="overflow-y: scroll;">
                                                    <abm v-bind:model="estado_financiero_aux" v-bind:editable="true" buttons='close,save,delete'></abm>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </carouselitem>
                    <!--
                        FIRMAS
                    -->
                    <carouselitem id="firmasDeAuditoria">
                        <div class="row wrapper border-bottom white-bg page-heading">
                            <div class="col-lg-10">
                                <h2>Firmas de auditoria</h2>
                            </div>
                            <div class="wrapper wrapper-content">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="ibox float-e-margins">
                                            <div class="ibox-content">
                                                <div class="table-responsive" style="overflow-y: scroll;">
                                                    <abm id="abmFirmasDeAuditoria" v-bind:model="firma_auditoria" v-bind:editable="false"></abm>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </carouselitem>
                    <!--
                        UAI
                    -->
                    <carouselitem id="UAI">
                        <div class="row wrapper border-bottom white-bg page-heading">
                            <div class="col-lg-10">
                                <h2>UAI</h2>
                            </div>
                            <div class="wrapper wrapper-content">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="ibox float-e-margins">
                                            <div class="ibox-content">
                                                <div class="table-responsive" style="overflow-y: scroll;">
                                                    <abm id="abmUAI" v-bind:model="uai" v-bind:editable="false" toolbar='new,search'></abm>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </carouselitem>
                    <!--
                        Seguimiento de tareas
                    -->
                    <carouselitem id="seguimientoDeTareas">
                        <div class="wrapper wrapper-content animated fadeInUp">

                            <div class="ibox">
                                <div class="ibox-title">
                                    <h5>Tareas</h5>
                                    <div class="ibox-tools">
                                        <a href="#asignarTarea" class="btn btn-primary btn-xs" v-on:click='crearTarea'>Asignar tarea</a>
                                    </div>
                                </div>
                                <div class="ibox-content">
                                    <div class="row m-b-sm m-t-sm">
                                        <div class="col-md-1">
                                            <button type="button" id="loading-example-btn" class="btn btn-white btn-sm" v-on:click='listarTareas'><i class="fa fa-refresh"></i> Recargar</button>
                                        </div>
                                        <div class="col-md-11">
                                            <div class="input-group">
                                                <input type="text" placeholder="Busqueda" class="input-sm form-control" v-model="busquedaTareas">
                                                <span class="input-group-btn"><button type="button" class="btn btn-sm btn-primary" v-on:click="buscarTarea"> Buscar</button> </span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="project-list">

                                        <table class="table table-hover">
                                            <tbody>
                                                <tr v-for='tareaI in tareas'>
                                                    <td class="project-status">
                                                        <span class="label label-primary">{{tareaI.attributes.estado}}</span>
                                                    </td>
                                                    <td class="project-title">
                                                        <a href="#detalleTarea" v-on:click='seleccionaTarea(tareaI)'>{{tareaI.attributes.cod_tarea}} {{tareaI.attributes.nombre_tarea}}</a>
                                                        <br>
                                                        <small>{{tareaI.attributes.created_at}}</small>
                                                    </td>
                                                    <td class="project-completion">
                                                        <small>Avance: {{tareaI.attributes.avance}}%</small>
                                                        <div class="progress progress-mini">
                                                            <div v-bind:style="{width: tareaI.attributes.avance+'%'}" v-bind:class="{
                                                                'progress-bar': true,
                                                                'progress-bar-danger': tareaI.attributes.avance*1 <= 30,
                                                                'progress-bar-warning': 30 < tareaI.attributes.avance*1 && tareaI.attributes.avance*1 < 70,
                                                                'progress-bar-primary': 70 <= tareaI.attributes.avance*1
                                                            }"></div>
                                                        </div>
                                                    </td>
                                                    <td class="project-user">
                                                        {{tareaI.relationships.usuario.attributes.nombres+' '+tareaI.relationships.usuario.attributes.apellidos}}
                                                    </td>
                                                    <td class="project-actions">
                                                        <a href="#detalleTarea" class="btn btn-white btn-sm" v-on:click='seleccionaTarea(tareaI)'><i class="fa fa-folder"></i> Ver </a>
                                                        <a href="#registrarAvance" class="btn btn-white btn-sm" v-on:click='registrarAvanceTarea(tareaI)'><i class="fa fa-forward"></i> Avance </a>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </carouselitem>
                    <!--
                        Visualizar detalle de tarea
                    -->
                    <carouselitem id="detalleTarea">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="wrapper wrapper-content animated fadeInUp">
                                    <div class="ibox">
                                        <div class="ibox-content">
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <div class="m-b-md">
                                                        <a href="#registrarAvance" class="btn btn-success btn-xs pull-right" v-on:click="crearAvance">Registrar avance</a>
                                                        <h2>{{tarea.cod_tarea}} {{tarea.nombre_tarea}}</h2>
                                                    </div>
                                                    <dl class="dl-horizontal">
                                                        <dt>Estado:</dt> <dd><span class="label label-primary">{{tarea.estado}}</span></dd>
                                                        <div style="height: 4px;"></div>
                                                        <dt>Prioridad:</dt>
                                                        <dd>
                                                            <p class="small font-bold">
                                                                <span><i v-bind:class="{'fa fa-circle':true, 'text-danger':tarea.prioridad=='Alta', 'text-warning':tarea.prioridad=='Media', 'text-primary':tarea.prioridad=='Baja'}"></i> {{tarea.prioridad}}</span>
                                                            </p>
                                                        </dd>
                                                    </dl>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-5">
                                                    <dl class="dl-horizontal">
                                                        <dt>Creado por:</dt> <dd>{{tarea.revisor1 ? tarea.revisor1.attributes.username : ''}}</dd>
                                                        <dt>Asignado a:</dt> <dd>{{typeof tarea.usuario=='object' && tarea.usuario ? (tarea.usuario.attributes ? tarea.usuario.attributes.username: tarea.usuario.username) : ''}}</dd>
                                                    </dl>
                                                </div>
                                                <div class="col-lg-7" id="cluster_info">
                                                    <dl class="dl-horizontal">

                                                        <dt>Creación:</dt> <dd>{{tarea.created_at}}</dd>
                                                        <dt>Última actualización:</dt> <dd>{{tarea.updated_at}}</dd>
                                                    </dl>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <dl class="dl-horizontal">
                                                        <dt>Avance:</dt>
                                                        <dd>
                                                            <div v-bind:class="{'progress progress-striped active m-b-sm': tarea.avance < 100, 'progress progress-bar-default': tarea.avance == 100 }">
                                                                <div v-bind:style="{width: tarea.avance+'%'}" v-bind:class="{
                                                                     'progress-bar': true,
                                                                     'progress-bar-danger': tarea.avance <= 30,
                                                                     'progress-bar-warning': 30 < tarea.avance && tarea.avance < 70,
                                                                     'progress-bar-primary': 70 <= tarea.avance
                                                                }"></div>
                                                            </div>
                                                            <small>
                                                                El avance de la tarea es de <strong>{{tarea.avance}}%</strong>.
                                                            </small>
                                                        </dd>
                                                    </dl>
                                                </div>
                                            </div>
                                            <div class="row m-t-sm">
                                                <div class="col-lg-12">
                                                    <div class="panel blank-panel">
                                                        <div class="panel-heading">
                                                            <div class="panel-options">
                                                                <ul class="nav nav-tabs">
                                                                    <li class="active"><a href="#tab-1" data-toggle="tab">Descripción</a></li>
                                                                    <li class=""><a href="#tab-2" data-toggle="tab">Actividades</a></li>
                                                                </ul>
                                                            </div>
                                                        </div>

                                                        <div class="panel-body">

                                                            <div class="tab-content">
                                                                <div class="tab-pane active" id="tab-1">
                                                                    <p>
                                                                        {{tarea.descripcion}}
                                                                    </p>
                                                                    <h5>Adjuntos</h5>
                                                                    <ul class="list-unstyled project-files">
                                                                        <li v-for="adjunto in tarea.adjuntos" v-if='adjunto.attributes.archivo'><a :href="adjunto.attributes.archivo?adjunto.attributes.archivo.url:''"><i class="fa fa-file"></i> {{adjunto.attributes.archivo?adjunto.attributes.archivo.name:''}}</a></li>
                                                                    </ul>
                                                                    <div id='agregarAdjunto'>
                                                                        <dv-form :model="Adjunto" v-on:save="adjuntarArchivo" buttons="save"></dv-form>
                                                                    </div>

                                                                </div>
                                                                <div class="tab-pane" id="tab-2">

                                                                    <table class="table table-striped">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>Avance</th>
                                                                                <th>Fecha y Hora</th>
                                                                                <th>Comentarios</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            <tr v-for="avance in tarea.avances">
                                                                                <td>
                                                                                    <span class="label label-primary">{{avance.attributes.avance}}</span>
                                                                                </td>
                                                                                <td>
                                                                                    {{avance.attributes.created_at}}
                                                                                </td>
                                                                                <td>
                                                                                    <p class="small">
                                                                                        {{avance.attributes.descripcion}}
                                                                                    </p>
                                                                                </td>

                                                                            </tr>
                                                                        </tbody>
                                                                    </table>

                                                                </div>
                                                            </div>

                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </carouselitem>
                    <!--
                        Asignar una nueva tarea
                    -->
                    <carouselitem id="asignarTarea">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="wrapper wrapper-content animated fadeInUp">
                                    <div class="ibox">
                                        <div class="ibox-title">
                                            <h5>Tarea</h5>
                                            <div class="ibox-tools">
                                                <a href="#seguimientoDeTareas" class="btn btn-primary btn-xs" v-on:click='guardarTarea'>Guardar Tarea</a>
                                            </div>
                                        </div>
                                        <div class="ibox-content">
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <dl class="dl-horizontal">
                                                        <dt>Código:</dt> <dd>(se generará al asignar la tarea)</dd>
                                                    </dl>
                                                    <dl class="dl-horizontal">
                                                        <dt>Tarea:</dt> <dd><input type="text" class="form-control" placeholder="tarea" v-model="tarea.nombre_tarea"></dd>
                                                    </dl>
                                                    <dl class="dl-horizontal">
                                                        <dt>Estado:</dt> <dd><span class="label label-primary">Pendiente</span></dd>
                                                    </dl>
                                                    <dl class="dl-horizontal">
                                                        <dt>Prioridad:</dt>
                                                        <dd>
                                                            <select class="form-control" placeholder="prioridad" v-model="tarea.prioridad">
                                                                <option value="Baja">Baja</option>
                                                                <option value="Media">Media</option>
                                                                <option value="Alta">Alta</option>
                                                            </select>
                                                        </dd>
                                                    </dl>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-5">
                                                    <dl class="dl-horizontal">
                                                        <dt>Creado por:</dt> <dd>{{user.nombres + ' ' + user.apellidos}}</dd>
                                                    </dl>
                                                    <dl class="dl-horizontal">
                                                        <dt>Asignado a:</dt> <dd>
                                                            <select class="form-control" placeholder="asignado" v-model="tarea.usuario">
                                                                <option value="1">Angela Choque</option>
                                                            </select>
                                                        </dd>
                                                    </dl>
                                                </div>
                                                <div class="col-lg-7" id="cluster_info">
                                                    <dl class="dl-horizontal">

                                                        
                                                        
                                                    </dl>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <dl class="dl-horizontal">
                                                        <dt>Avance:</dt>
                                                        <dd>
                                                            <div class="progress progress-striped active m-b-sm">
                                                                <div v-bind:style="{width: tarea.avance+'%'}" class="progress-bar progress-bar-warning"></div>
                                                            </div>
                                                            <small>
                                                                El avance de la tarea es de <strong>{{tarea.avance}}%</strong>.
                                                            </small>
                                                        </dd>
                                                    </dl>
                                                </div>
                                            </div>
                                            <div class="row m-t-sm">
                                                <div class="col-lg-12">
                                                    <div class="panel blank-panel">
                                                        <div class="panel-heading">
                                                            <div class="panel-options">
                                                                <ul class="nav nav-tabs">
                                                                    <li class="active"><a href="#tab-1" data-toggle="tab">Descripción</a></li>
                                                                    <li class=""><a href="#tab-2" data-toggle="tab">Actividades</a></li>
                                                                </ul>
                                                            </div>
                                                        </div>

                                                        <div class="panel-body">

                                                            <div class="tab-content">
                                                                <div class="tab-pane active" id="tab-1">
                                                                    <p>
                                                                        <textarea class="form-control" v-model="tarea.descripcion" placeholder="Descripción"></textarea>
                                                                    </p>
                                                                    <h5>Adjuntos</h5>
                                                                    <ul class="list-unstyled project-files">
                                                                        <li v-for="adjunto in tarea.adjuntos" v-if='adjunto.attributes.archivo'><a :href="adjunto.attributes.archivo?adjunto.attributes.archivo.url:''"><i class="fa fa-file"></i> {{adjunto.attributes.archivo?adjunto.attributes.archivo.name:''}}</a></li>
                                                                    </ul>
                                                                    <div class="text-center m-t-md">
                                                                        
                                                                    </div>

                                                                </div>
                                                                <div class="tab-pane" id="tab-2">

                                                                    <table class="table table-striped">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>Avance</th>
                                                                                <th>Fecha y Hora</th>
                                                                                <th>Comentarios</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            <tr v-for="avance in tarea.avances">
                                                                                <td>
                                                                                    <span class="label label-primary">{{avance.attributes.avance}}</span>
                                                                                </td>
                                                                                <td>
                                                                                    {{avance.attributes.created_at}}
                                                                                </td>
                                                                                <td>
                                                                                    <p class="small">
                                                                                        {{avance.attributes.descripcion}}
                                                                                    </p>
                                                                                </td>

                                                                            </tr>
                                                                        </tbody>
                                                                    </table>

                                                                </div>
                                                            </div>

                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </carouselitem>
                    <!--
                        Registrar avance de tarea
                    -->
                    <carouselitem id="registrarAvance">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="wrapper wrapper-content animated fadeInUp">
                                    <div class="ibox">
                                        <div class="ibox-content">
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <div class="m-b-md">
                                                        <a href="javascript:history.back()" class="btn btn-success btn-xs pull-right" v-on:click="guardarAvance">Guardar avance</a>
                                                        <h2>{{tarea.cod_tarea}} {{tarea.nombre_tarea}}</h2>
                                                    </div>
                                                    <dl class="dl-horizontal">
                                                        <dt>Estado:</dt> <dd><span class="label label-primary">{{tarea.estado}}</span></dd>
                                                        <div style="height: 4px;"></div>
                                                        <dt>Prioridad:</dt>
                                                        <dd>
                                                            <p class="small font-bold">
                                                                <span><i v-bind:class="{'fa fa-circle':true, 'text-danger':tarea.prioridad=='Alta', 'text-warning':tarea.prioridad=='Media', 'text-primary':tarea.prioridad=='Baja'}"></i> {{tarea.prioridad}}</span>
                                                            </p>
                                                        </dd>
                                                    </dl>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-5">
                                                    <dl class="dl-horizontal">
                                                        <dt>Creado por:</dt> <dd>{{tarea.revisor1 ? tarea.revisor1.attributes.username : ''}}</dd>
                                                        <dt>Asignado a:</dt> <dd>{{typeof tarea.usuario=='object' && tarea.usuario ? (tarea.usuario.attributes ? tarea.usuario.attributes.username: tarea.usuario.username) : ''}}</dd>
                                                    </dl>
                                                </div>
                                                <div class="col-lg-7" id="cluster_info">
                                                    <dl class="dl-horizontal">

                                                        <dt>Creación:</dt> <dd>{{tarea.created_at}}</dd>
                                                        <dt>Última actualización:</dt> <dd>{{tarea.updated_at}}</dd>
                                                    </dl>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <dl class="dl-horizontal">
                                                        <dt>Avance:</dt>
                                                        <dd>
                                                            <input type="number" min="0" max="100" class="form-control" placeholder="avance" v-model="avance.avance">
                                                        </dd>
                                                    </dl>
                                                    <dl class="dl-horizontal">
                                                        <dt>Comentario de avance:</dt>
                                                        <dd>
                                                            <textarea class="form-control" v-model="avance.descripcion" placeholder="Descripción"></textarea>
                                                        </dd>
                                                    </dl>
                                                </div>
                                            </div>
                                            <div class="row m-t-sm">
                                                <div class="col-lg-12">
                                                    <div class="panel blank-panel">
                                                        <div class="panel-heading">
                                                            <div class="panel-options">
                                                                <ul class="nav nav-tabs">
                                                                    <li class="active"><a href="#tab-1" data-toggle="tab">Descripción</a></li>
                                                                    <li class=""><a href="#tab-2" data-toggle="tab">Actividades</a></li>
                                                                </ul>
                                                            </div>
                                                        </div>

                                                        <div class="panel-body">

                                                            <div class="tab-content">
                                                                <div class="tab-pane active" id="tab-1">
                                                                    <p>
                                                                        {{tarea.descripcion}}
                                                                    </p>
                                                                    <h5>Adjuntos</h5>
                                                                    <ul class="list-unstyled project-files">
                                                                        <li v-for="adjunto in tarea.adjuntos" v-if='adjunto.attributes.archivo'><a :href="adjunto.attributes.archivo?adjunto.attributes.archivo.url:''"><i class="fa fa-file"></i> {{adjunto.attributes.archivo?adjunto.attributes.archivo.name:''}}</a></li>
                                                                    </ul>
                                                                    <div class="text-center m-t-md">
                                                                        
                                                                    </div>

                                                                </div>
                                                                <div class="tab-pane" id="tab-2">

                                                                    <table class="table table-striped">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>Avance</th>
                                                                                <th>Fecha y Hora</th>
                                                                                <th>Comentarios</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            <tr v-for="avance in tarea.actividades">
                                                                                <td>
                                                                                    <span class="label label-primary">{{avance.attributes.avance}}</span>
                                                                                </td>
                                                                                <td>
                                                                                    {{avance.attributes.created_at}}
                                                                                </td>
                                                                                <td>
                                                                                    <p class="small">
                                                                                        {{avance.attributes.descripcion}}
                                                                                    </p>
                                                                                </td>

                                                                            </tr>
                                                                        </tbody>
                                                                    </table>

                                                                </div>
                                                            </div>

                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </carouselitem>
                </carousel>


            </div>         

        </div>

        <!-- Mainly scripts -->
        <script src="../js/server.js?v0.26"></script>
        <script>
        $(document).ready(function () {
            var app = new Vue({
                el: '#wrapper',
                carousel: {},
                tareaAvance: 0,
                data: function () {
                    var self = this;
                    return {
                        user: new UserAdministration.User("/api/UserAdministration/users", localStorage.user_id),
                        empresa: new UserAdministration.Empresa(),
                        empresa_estado: new UserAdministration.EmpresaEstado(),
                        estado_financiero_aux: new UserAdministration.EstadoFinanciero(),
                        firma_auditoria: new UserAdministration.Firma(),
                        uai: new UserAdministration.Uai(),
                        tarea: new UserAdministration.Tarea(),
                        avance: new UserAdministration.Avance(function(){return app.tarea && app.tarea.id? ("/api/UserAdministration/tareas/"+app.tarea.id+"/avances") : "/api/UserAdministration/avances"}),
                        estados_financieros: [],
                        Adjunto: new UserAdministration.Adjunto(function(){return app.tarea && app.tarea.id? ("/api/UserAdministration/tareas/"+app.tarea.id+"/adjuntos") : "/api/UserAdministration/adjuntos"}),
                        PathItem: [],
                        busquedaTareas: '',
                        tareasTodas: [],
                        tareas: [],
                    };
                },
                methods: {
                    seleccionaEmpresa: function () {
                        window.location.hash = '#descripcionEmpresa';
                    },
                    listarTareas: function () {
                        var self = this;
                        this.tareasTodas.splice(0);
                        this.tarea.$select(function (data) {
                            data.data.forEach(function (row) {
                                self.tareasTodas.push(row);
                            });
                            self.pintarTareas();
                        });
                    },
                    pintarTareas: function () {
                        var self = this;
                        self.tareas.splice(0);
                        var limit = 50;
                        self.tareasTodas.forEach(function (row) {
                            if (self.tareas.length>=limit) {
                                return;
                            }
                            if (self.busquedaTareas) {
                                for(var att in row.attributes) {
                                    var val = row.attributes[att];
                                    if (
                                        (val && typeof val.indexOf==='function' &&
                                        val.indexOf(self.busquedaTareas)!==-1) ||
                                        val==self.busquedaTareas
                                    ) {
                                        console.log(val, self.busquedaTareas);
                                        self.tareas.push(row);
                                        break;
                                    }
                                }
                            } else {
                                self.tareas.push(row);
                            }
                        });
                    },
                    seleccionaTarea: function (tarea) {
                        this.tarea.$load(tarea.id);
                    },
                    crearTarea: function () {
                        this.tarea.$load(0);
                    },
                    guardarTarea: function () {
                        var self = this;
                        this.tarea.$save('', function() {
                            self.listarTareas();
                        });
                    },
                    crearAvance: function () {
                        this.avance.$load(0);
                    },
                    guardarAvance: function () {
                        var self = this;
                        this.avance.tarea_id = this.tarea.id;
                        this.avance.$save('', function() {
                            self.listarTareas();
                            self.tarea.$load(self.tarea.id);
                        });
                    },
                    registrarAvanceTarea: function (tarea) {
                        this.tarea.$load(tarea.id);
                        this.avance.$load(0);
                    },
                    adjuntarArchivo: function () {
                        console.log("entro!!");
                        this.Adjunto.$load(0);
                        this.tarea.$load(this.tarea.id);
                    },
                    abrirUAI: function () {
                        $("#abmUAI").get(0).__vue__.goto(0);
                    },
                    abrirFirmasDeAuditoria: function () {
                        $("#abmFirmasDeAuditoria").get(0).__vue__.goto(0);
                    },
                    buscarTarea: function () {
                        this.pintarTareas();
                    },
                    cargarEstadosFinancieros: function () {
                        var model = new UserAdministration.EstadoFinanciero("/api/UserAdministration/empresa_estados/" + app.empresa_estado.id + "/estados");
                        model.$select(function (resultado) {
                            app.estados_financieros.splice(0);
                            resultado.data.forEach(function (row) {
                                app.estados_financieros.push(row);
                            });
                            Vue.nextTick(function () {
                                $("span.peityChart").each(function () {
                                    var chart = $(this).attr("chart") ? $(this).attr("chart") : 'pie';
                                    $(this).peity(chart, {
                                        fill: chart === 'pie' || chart === 'bar' ? ['#1ab394', '#d7d7d7', '#8CD9C9'] : '#1ab394',
                                        width: 80,
                                        height: 80
                                    })
                                });
                            });
                        });
                    },
                    addCommas: function (nStr)
                    {
                        nStr += '';
                        x = nStr.split('.');
                        x1 = x[0];
                        x2 = x.length > 1 ? '.' + x[1] : '';
                        var rgx = /(\d+)(\d{3})/;
                        while (rgx.test(x1)) {
                            x1 = x1.replace(rgx, '$1' + ',' + '$2');
                        }
                        return x1 + x2;
                    }
                },
                mounted: function () {
                    var self = this;
                    this.carousel = this.$children[0];
                    $("#now_loading").hide();
                    $(this.$el).css("visibility", "visible");
                    var hash0 = location.hash;
                    location.hash = '';
                    location.hash = hash0;
                    this.listarTareas();
                }
            });
            window.app = app;
        });
        </script>
        <!-- Peity -->
        <script src="js/plugins/peity/jquery.peity.min.js"></script>

        <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
        <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
        <script src="js/inspinia.js"></script>
    </body>
</html>
